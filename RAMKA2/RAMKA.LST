Turbo Assembler	 Version 4.1	    16/02/25 15:19:50	    Page 1
ramka.asm



      1	0000			     .model tiny
      2	0000			     .code
      3				     .186
      4				     locals qq
      5				     org 100h
      6
      7				     ; ;-----------------DEBUG--------------------------
      8				     ;	     mov byte ptr es:[DEBUG_OFFSET], al
      9				     ;	     mov byte ptr es:[DEBUG_OFFSET+2], ah
     10				     ; ;-----------------DEBUG--------------------------
     11
     12	      =0370		     DEBUG_OFFSET	     equ 880
     13
     14				     ; Window
     15	      =B800		     VIDEOSEG			     equ 0b800h
     16	      =0050		     WC_WIDTH			     equ 80
     17	      =0019		     WC_HEIGHT			     equ 25
     18	      =0004		     GC_RAMKA_GAP	     equ 4
     19	      =0002		     VC_RAMKA_GAP	     equ 2
     20
     21				     ;Symbols
     22	      =000A		     SYM_LF			     equ 0ah
     23	      =000D		     SYM_CR			     equ 0dh
     24	      =0003		     SYM_HEART			     equ 03h
     25
     26				     ;Times
     27	      =001E		     TWO_SECONDS1	     equ 1eh
     28	      =8480		     TWO_SECONDS2	     equ 8480h
     29	      =000F		     ONE_SECONDS1	     equ 0fh
     30	      =4240		     ONE_SECONDS2	     equ 4240h
     31	      =0001		     HUNDRED_MSECONDS1	     equ 1h
     32	      =86A0		     HUNDRED_MSECONDS2	     equ 86A0h
     33	      =2710		     TEN_MSECONDS	     equ 2710h
     34
     35				     ;=======================MAIN======================
     36
     37	0100			     Start:
     38
     39	0100  BF 0009r			 mov di, offset	String
     40	0103  E8 0014			 call CountTextSizes
     41
     42				     ;-----------------DEBUG--------------------------
     43	0106  B9 B800			     mov cx, VIDEOSEG
     44	0109  8E C1			     mov es, cx
     45	010B  26: 88 1E	0370		     mov byte ptr es:[DEBUG_OFFSET], bl
     46	0110  26: 88 3E	0372		     mov byte ptr es:[DEBUG_OFFSET+2], bh
     47				     ;-----------------DEBUG--------------------------
     48
     49	0115  B8 4C00			 mov ax, 4c00h;	end programm
     50	0118  CD 21			     int 21h
     51
     52				     ;=======================FUNCS======================
     53
     54				     ;---------------------------------------------
     55				     ;Descript:	     Count sizes of text with 0	in end,
     56				     ;		 Max size of line - WC_WIDTH
     57				     ;Entry:	     ES:DI = Start text
Turbo Assembler	 Version 4.1	    16/02/25 15:19:50	    Page 2
ramka.asm



     58				     ;Exit:	     BH	= max count symbols in text line
     59				     ;			     BL	= count	text line
     60				     ;			     fill string_sizes
     61				     ;Destroy:	     DI, AL, CX, DX
     62				     ;---------------------------------------------
     63	011A			     CountTextSizes  proc
     64
     65	011A  32 FF			     xor bh, bh			     ; bh = 0
     66	011C  32 F6			 xor dh, dh	     ; dh = 0 (counter bl)
     67	011E  B0 0D			     mov al, SYM_CR	     ; for scasb
     68
     69	0120			     qqCycle:
     70	0120  FE C7			     inc bh			     ; ++bh (new line)
     71
     72	0122  B1 50			     mov cl, WC_WIDTH	     ; set counter
     73	0124  F2> AE			     repne scasb		     ; while(es:[di++] != al &&	cl != 0)
     74
     75				     ;;; dl = WC_WIDTH - cl (line size)
     76	0126  B2 4F			     mov dl, WC_WIDTH -	1
     77	0128  2A D1			     sub dl, cl
     78
     79	012A  E8 0008			     call MinMax	     ; dh max= dl
     80
     81	012D  80 3D 0A			     cmp byte ptr [di],	SYM_LF
     82	0130  74 EE		     je	qqCycle
     83
     84	0132  8A DE			     mov bl, dh
     85	0134  C3			     ret
     86	0135			     endp
     87
     88				     ;---------------------------------------------
     89				     ;Descript:	     Get Min
     90				     ;Entry:	     DL	= First
     91				     ;			     DH	= Second
     92				     ;Exit:	     DH	= MAX
     93				     ;			     DL	= MIN
     94				     ;Destroy:	     CH
     95				     ;---------------------------------------------
     96	0135			     MinMax  proc
     97	0135  3A D6			     cmp dl, dh
     98
     99	0137  7E 06		     jle qqSkipSwap
    100	0139  8A EA			     mov ch, dl
    101	013B  8A D6			     mov dl, dh
    102	013D  8A F5			     mov dh, ch
    103	013F			     qqSkipSwap:
    104
    105	013F  C3			     ret
    106	0140			     endp
    107
    108	0140			     .data
    109	0000  2B 2D 2B 7C 2E 7C	2B+  Symbols db	'+-+|.|+-+'
    110	      2D 2B
    111	0009  53 77 65 61 74 20	46+  String db	     'Sweat February 14th Valentine!', SYM_CR, SYM_LF, \
    112	      65 62 72 75 61 72	79+			'Ded lox hihihi', SYM_CR, SYM_LF, \
    113	      20 31 34 74 68 20	56+			'Mne sosal Stepa Gizunov', SYM_CR, SYM_LF,\
    114	      61 6C 65 6E 74 69	6E+			'Masik kupi mne	mashinku!!!', SYM_HEART, SYM_CR, \
Turbo Assembler	 Version 4.1	    16/02/25 15:19:50	    Page 3
ramka.asm



    115	      65 21 0D 0A 44 65	64+			0h
    116	      20 6C 6F 78 20 68	69+
    117	      68 69 68 69 0D 0A	4D+
    118	      6E 65 20 73 6F 73	61+
    119	      6C 20 53 74 65 70	61+
    120	      20 47 69 7A 75 6E	6F+
    121	      76 0D 0A 4D 61 73	69+
    122	      6B 20 6B 75 70 69	20+
    123	      6D 6E 65 20 6D 61	73+
    124	      68 69 6E 6B 75 21	21+
    125	      21 03 0D 00
    126	006F			     StringSizes:
    127
    128				     end Start
Turbo Assembler	 Version 4.1	    16/02/25 15:19:50	    Page 4
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "16/02/25"
??FILENAME			  Text	 "ramka	  "
??TIME				  Text	 "15:19:50"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0103H
@CURSEG				  Text	 _DATA
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 RAMKA
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
COUNTTEXTSIZES			  Near	 DGROUP:011A
DEBUG_OFFSET			  Number 0370
GC_RAMKA_GAP			  Number 0004
HUNDRED_MSECONDS1		  Number 0001
HUNDRED_MSECONDS2		  Number 86A0
MINMAX				  Near	 DGROUP:0135
ONE_SECONDS1			  Number 000F
ONE_SECONDS2			  Number 4240
QQCYCLE				  Near	 DGROUP:0120
QQSKIPSWAP			  Near	 DGROUP:013F
START				  Near	 DGROUP:0100
STRING				  Byte	 DGROUP:0009
STRINGSIZES			  Near	 DGROUP:006F
SYMBOLS				  Byte	 DGROUP:0000
SYM_CR				  Number 000D
SYM_HEART			  Number 0003
SYM_LF				  Number 000A
TEN_MSECONDS			  Number 2710
TWO_SECONDS1			  Number 001E
TWO_SECONDS2			  Number 8480
VC_RAMKA_GAP			  Number 0002
VIDEOSEG			  Number B800
WC_HEIGHT			  Number 0019
WC_WIDTH			  Number 0050

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  006F Word	  Public  DATA
  _TEXT				  16  0140 Word	  Public  CODE
